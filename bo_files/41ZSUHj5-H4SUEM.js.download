window.aui.amd_define("@amzn/webflow-js",["exports","@amzn/kata-web-framework-external-config","@amzn/kata-web-framework-external-composed","@amzn/webflow-js-register-view-model-mapper","@amzn/kata-web-framework-rxjs-adapter","@amzn/webflow-rx","@amzn/kata-web-framework-patch"],function(x,$e,Ve,Ue,qe,F,Ne){"use strict";function We(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const r in t)if(r!=="default"){const n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:()=>t[r]})}}return e.default=t,Object.freeze(e)}const Y=We(Ne);function Le(t,e){de.registerFunction(t,e)}function Je(t,e){return de.invokeFunction(t,e)}const Z=["WebFlowJsUrlParameters","pageHostOverride","showInsight","tinkerId","auiDebug"],ze=["showInsight"];function Q(){if(Ge()||He())return!0;const t=new URLSearchParams(window.location.search);for(const e of ze)if(t.has(e))return!0;return!1}function He(){return window.location.href.includes("webflow-preview")}function Ge(){return window.location.href.includes("localhost")}const w=(...t)=>{Q()&&console.log(...t)},W=(...t)=>{Q()&&console.warn(...t)},Ke=(t,e)=>{Q()&&console.error(t,e)},ye=(t,e,r)=>{if(window.ueLogError){const n=r||new Error(e);window.ueLogError(n,{logLevel:t,attribution:"webflow_js",message:"WebFlowJS: "+e}),Ke(e,n)}},E=(t,e)=>ye("ERROR",t,e),M=(t,e)=>ye("FATAL",t,e);let k;const Ye=({messages:t,toastPosition:e})=>{t.subscribe(r=>{var s,a,u,c;w(`showToast: ${r}`);const n=document.createElement("div");n.id="toast",n.style.position="fixed",n.style.bottom=((s=e==null?void 0:e.web)==null?void 0:s.bottom)??"75px",n.style.left=((a=e==null?void 0:e.web)==null?void 0:a.left)??"50%",n.style.right=((u=e==null?void 0:e.web)==null?void 0:u.right)??"auto",n.style.top=((c=e==null?void 0:e.web)==null?void 0:c.top)??"auto",n.style.transform="translateX(-50%)",n.style.display="flex",n.style.width="100%",n.style.flexDirection="row",n.style.alignItems="center",n.style.zIndex="9999",n.style.alignSelf="center",n.style.justifyContent="center",n.style.padding="16px",n.style.backgroundColor="#0F1111",n.style.borderRadius="8px",k==null||k(),k=()=>{n.remove(),k=void 0};const o=document.createElement("span");o.textContent=r,o.style.textAlign="left",o.style.lineHeight="20px",o.style.flex="6",o.style.fontSize="16",o.style.fontWeight="400",o.style.color="#FFFFFF",n.appendChild(o),document.body.appendChild(n),setTimeout(()=>{n&&n.remove()},2400)})},Ze="<p style='height:100vh;'></p>",Qe=t=>`
    background-color: white;
    color: black;
    padding: 25px;
    height: ${t}px;
    position: fixed;
    width: 100vw;
    bottom: 0;
`,Xe=(t,e)=>`
    <div id="${t}" style="${Qe(e)}"></div>
`,et=({rawInfoText:t})=>{w(`showPriceInfo: ${t}`),(window.top||window).P.when("a-modal-framework","a-sheet").execute("show-price-info",function(r,n){var i;const o="a-modal-showPriceInfo",s={name:"showPriceInfoModal"},a=((i=n.get("webflow-bottomsheet-instance"))==null?void 0:i._height)||600,u=Xe(o,a),c={type:"inline",source:t+Ze};new r(u,c,s).present()})},we="/webflow-rx/",tt="http://localhost:8080",L={requestType:"cart.add-items.request/v1",resourcePath:"items/v1",responseType:"cart.add-items/v1",method:"POST",callbackId:"your-saves-immersive-view-experience/Mon Aug 07 2023 13:36:46 GMT-0700 (Pacific Daylight Time)/919866f55af84162a94a6928be5b040636954948bb80db9cc3fe96fbab901b2a"};class rt{async callbackToWebFlowServer(e){const r=this.constructUrl(e);return fetch(r,this.buildRequest(e)).then(n=>n).catch(n=>(M("Something went wrong with the fetch call: "+n.message,n),{}))}buildRequest(e){return{headers:this.buildHeaders(),method:e.method,body:JSON.stringify(e)}}buildHeaders(){const e={Accept:"application/vnd.com.amazon.xa+json"},r=document.querySelector('meta[name="flow-closure-id"]');if(r){const n=r.getAttribute("content");n&&(e["x-amzn-flow-closure-id"]=n)}return e}constructUrl(e){const r=new URLSearchParams(window.location.search);if(r.has("webflowrxMockResponse"))return new URL(`${tt}?mock-response=${r.get("webflowrxMockResponse")}`);const n=new URLSearchParams;r.forEach((c,l)=>{Z.some(i=>i.toLowerCase()===l.toLowerCase())&&n.set(l,c)});const o=e.flowRoute,s=this.getServerEndpoint().toString()+((o==null?void 0:o.flow.experienceId)??"");o!=null&&o.flow.inputs&&Object.entries(o.flow.inputs).forEach(([c,l])=>{if(l!=="placeholder"){const d=typeof l=="object"&&l!==null?JSON.stringify(l):String(l);n.set(c,d)}});const a=n.toString(),u=a?"?"+a+"&":"";return new URL(s+u)}getUrlParameters(e){let r="";return Z.forEach(n=>{const o=e.get(n);o!=null&&(r+=n+"="+o+"&")}),r!=""?"?"+r:r}getServerEndpoint(){if(location.hostname.includes("amazon")){const e=new URL(location.origin);return e.pathname=we,e}return new URL("https://pre-prod.amazon.com"+we)}}var j=(t=>(t[t.AmazonApi=0]="AmazonApi",t[t.Test=1]="Test",t))(j||{}),X=(t=>(t[t.Override=0]="Override",t[t.Skip=1]="Skip",t[t.ReplaceEntirely=2]="ReplaceEntirely",t))(X||{});const ge=class _{constructor(){if(_.instance)throw new Error("State manager is a singlaton class that should not be initialized more than once");this.clientSideStates=new Map,this.nodeStates=new Map}static getInstance(){return _.instance||(_.instance=new _),_.instance}postState(e,r,n,o){let s=this.clientSideStates.get(e);s||(s={}),s[r]=this.updatedState(s[r]??{},n,o),this.clientSideStates.set(e,s)}updatedState(e,r,n){if(n===0)return this.deepOverrideState(e,r);throw new Error("Unsupported collisionResolutionStrategy="+n)}updatedStateV2(e,r,n){if(n===0)return this.deepOverrideStateV2(e,r);throw new Error("Unsupported collisionResolutionStrategy="+n)}deepOverrideState(e,r){const n={...e};for(const o in r)typeof r[o]=="object"&&r[o]!==null&&typeof n[o]=="object"&&n[o]!==null?n[o]=this.deepOverrideState(n[o],r[o]):n[o]=r[o];return n}deepOverrideStateV2(e,r){const n={...e};for(const o in r)typeof r[o]=="object"&&r[o]!==null&&typeof n[o]=="object"&&n[o]!==null?Array.isArray(r[o])||Array.isArray(n[o])?n[o]=r[o]:n[o]=this.deepOverrideStateV2(n[o],r[o]):n[o]=r[o];return n}getState(e,r){const n=this.clientSideStates.get(e);if(n&&n[r]!==void 0)return n[r]}saveNodeState(e){this.nodeStates.set(e.id,e.state)}deleteNodeState(e){this.nodeStates.delete(e)}getNodeStates(){const e=[];return this.nodeStates.forEach((r,n)=>{e.push({id:n,state:r})}),e}getStateByVmmId(e,r,n){const o=`resource_${n}_vmmId_${r}`,s=this.clientSideStates.get(e);if(s&&s[o]!==void 0)return s[o]}postStateByVmmId(e,r,n,o,s){const a=`resource_${n}_vmmId_${r}`;let u=this.clientSideStates.get(e);u||(u={}),u[a]=this.updatedStateV2(u[a]??{},o,s),this.clientSideStates.set(e,u)}};ge.instance=null;let J=ge;class ee{static saveInitialRenderingStateV1(e,r){this.saveAapiResourceReferencesV1(e.aapiResourceReferences,r)}static saveAapiResourceReferencesV1(e,r){try{JSON.parse(e).references.forEach(o=>{const s={resourcePath:o.resource,entity:o.entity};this.stateManager.postState(j.AmazonApi,s.resourcePath,s,X.Override),r&&this.stateManager.postStateByVmmId(j.AmazonApi,r,s.resourcePath,s,X.Override)})}catch(n){throw new Error(`Unable to parse and save aapi state to client side.
            Input=${e}.
            Error message=${n.message}`)}}static saveNodeState(e){this.stateManager.saveNodeState(e)}}ee.stateManager=J.getInstance();const me=class q{constructor(){this.completedCount=0,this.completionSubject=new F.Subject,this.expectedCount=null,this.pollingInterval=null,this.startPolling()}static getInstance(){return q.instance||(q.instance=new q),q.instance}startPolling(){this.pollingInterval=setInterval(()=>{if(this.expectedCount===null){const e=document.querySelector("[data-webflow-rx-card-count]"),r=e==null?void 0:e.getAttribute("data-webflow-rx-card-count");r&&(this.expectedCount=parseInt(r,10),this.checkCompletion(),this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null))}},100),setTimeout(()=>{this.pollingInterval&&(E("WebFlowJS: Polling timeout - expected VMM count not found after 5 seconds"),clearInterval(this.pollingInterval),this.pollingInterval=null)},5e3)}markVMMComplete(){this.completedCount++,this.checkCompletion()}checkCompletion(){this.expectedCount!==null&&this.completedCount>=this.expectedCount&&this.completionSubject.next(!0)}resetRenderComplete(){this.completedCount=0,this.completionSubject=new F.Subject}getCompletionObservable(){return F.merge(F.of(!1),this.completionSubject.asObservable())}setExpectedCount(e){this.expectedCount=e}};me.instance=null;let z=me;const nt=()=>z.getInstance().getCompletionObservable();function ot(t){if(!t||typeof t!="object")return t;const e={};for(const r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;const n=t[r];typeof n!="function"&&(n&&typeof n=="object"&&n.__v_isRef?e[r]=n.value:e[r]=n)}return e}function st(t,e){$e.onExternalConfig("webflow",r=>{Array.isArray(r)?at(r,e):it(r,t)})}function at(t,e){t.forEach(r=>{switch(w("external config data: ",r),r.type){case"view-model-mapper":{(async()=>{const n=z.getInstance();try{ee.saveInitialRenderingStateV1(r.metadata,r.viewModelMapperUuid);const o=qe.createRxAdapterScope(),s=await Ue.executeViewModelMapper(r.viewModelMapperUuid,r.metadata),a=await o.externalComposed(r.externalComposedKey,s,{handleReentrantRender:async()=>{const u=ot(s);await e(r,a,u)}})}catch(o){E("WebFlow view model mapper execution failed. Event="+JSON.stringify(r),o)}finally{n.markVMMComplete()}})();break}case"node-state":{ee.saveNodeState({id:r.id,state:r.state});break}case"example":{w("WebFlow example event");break}}})}function it(t,e){Ve.externalComposed(t.cardRuntimeInstanceId,{[t.publisherFunction]:r=>e(t.cardRuntimeBundleURI,r)}),w("external config data: ",t)}class H{constructor(e){this.type=e}}var b=(t=>(t.ViewPublisherResponse="ViewPublisherResponse",t.CardRerenderResponse="CardRerenderResponse",t.RemoteViewModelMapperExecutionResponse="RemoteViewModelMapperExecutionResponse",t.RemoteAAPIBatchOperationResponse="RemoteAAPIBatchOperationResponse",t.RemoteAAPIOperationResponse="RemoteAAPIOperationResponse",t.LayoutDiffingResponse="LayoutDiffingResponse",t.UnknownResponse="UnknownResponse",t))(b||{});class ut extends H{constructor(e){super(b.UnknownResponse),this.payload=e}}function ct(t,e,r){return e=B(e),yt(t,te()?Reflect.construct(e,r||[],B(t).constructor):e.apply(t,r))}function be(t,e,r){if(te())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var o=new(t.bind.apply(t,n));return r&&$(o,r.prototype),o}function te(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(te=function(){return!!t})()}function lt(t,e){if(typeof t!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function dt(t){var e=lt(t,"string");return typeof e=="symbol"?e:String(e)}function v(t){"@babel/helpers - typeof";return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(t)}function Fe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Re(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,dt(n.key),n)}}function ve(t,e,r){return e&&Re(t.prototype,e),r&&Re(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function ft(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&$(t,e)}function B(t){return B=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},B(t)}function $(t,e){return $=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,o){return n.__proto__=o,n},$(t,e)}function pt(t){try{return Function.toString.call(t).indexOf("[native code]")!==-1}catch{return typeof t=="function"}}function re(t){var e=typeof Map=="function"?new Map:void 0;return re=function(n){if(n===null||!pt(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(n))return e.get(n);e.set(n,o)}function o(){return be(n,arguments,B(this).constructor)}return o.prototype=Object.create(n.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),$(o,n)},re(t)}function ht(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function yt(t,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ht(t)}function wt(t){return gt(t)||mt(t)||Se(t)||bt()}function gt(t){if(Array.isArray(t))return ne(t)}function mt(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Se(t,e){if(t){if(typeof t=="string")return ne(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ne(t,e)}}function ne(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function bt(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ft(t,e){var r=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=Se(t))||e&&t&&typeof t.length=="number"){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(c){throw c},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,a=!1,u;return{s:function(){r=r.call(t)},n:function(){var c=r.next();return s=c.done,c},e:function(c){a=!0,u=c},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(a)throw u}}}}var m=Object.prototype.hasOwnProperty;function D(t,e){return t=t.slice(),t.push(e),t}function oe(t,e){return e=e.slice(),e.unshift(t),e}var Rt=function(t){ft(e,t);function e(r){var n;return Fe(this,e),n=ct(this,e,['JSONPath should not be called with "new" (it prevents return of (unwrapped) scalar values)']),n.avoidNew=!0,n.value=r,n.name="NewError",n}return ve(e)}(re(Error));function p(t,e,r,n,o){if(!(this instanceof p))try{return new p(t,e,r,n,o)}catch(c){if(!c.avoidNew)throw c;return c.value}typeof t=="string"&&(o=n,n=r,r=e,e=t,t=null);var s=t&&v(t)==="object";if(t=t||{},this.json=t.json||r,this.path=t.path||e,this.resultType=t.resultType||"value",this.flatten=t.flatten||!1,this.wrap=m.call(t,"wrap")?t.wrap:!0,this.sandbox=t.sandbox||{},this.preventEval=t.preventEval||!1,this.parent=t.parent||null,this.parentProperty=t.parentProperty||null,this.callback=t.callback||n||null,this.otherTypeCallback=t.otherTypeCallback||o||function(){throw new TypeError("You must supply an otherTypeCallback callback option with the @other() operator.")},t.autostart!==!1){var a={path:s?t.path:e};s?"json"in t&&(a.json=t.json):a.json=r;var u=this.evaluate(a);if(!u||v(u)!=="object")throw new Rt(u);return u}}p.prototype.evaluate=function(t,e,r,n){var o=this,s=this.parent,a=this.parentProperty,u=this.flatten,c=this.wrap;if(this.currResultType=this.resultType,this.currPreventEval=this.preventEval,this.currSandbox=this.sandbox,r=r||this.callback,this.currOtherTypeCallback=n||this.otherTypeCallback,e=e||this.json,t=t||this.path,t&&v(t)==="object"&&!Array.isArray(t)){if(!t.path&&t.path!=="")throw new TypeError('You must supply a "path" property when providing an object argument to JSONPath.evaluate().');if(!m.call(t,"json"))throw new TypeError('You must supply a "json" property when providing an object argument to JSONPath.evaluate().');var l=t;e=l.json,u=m.call(t,"flatten")?t.flatten:u,this.currResultType=m.call(t,"resultType")?t.resultType:this.currResultType,this.currSandbox=m.call(t,"sandbox")?t.sandbox:this.currSandbox,c=m.call(t,"wrap")?t.wrap:c,this.currPreventEval=m.call(t,"preventEval")?t.preventEval:this.currPreventEval,r=m.call(t,"callback")?t.callback:r,this.currOtherTypeCallback=m.call(t,"otherTypeCallback")?t.otherTypeCallback:this.currOtherTypeCallback,s=m.call(t,"parent")?t.parent:s,a=m.call(t,"parentProperty")?t.parentProperty:a,t=t.path}if(s=s||null,a=a||null,Array.isArray(t)&&(t=p.toPathString(t)),!(!t&&t!==""||!e)){var i=p.toPathArray(t);i[0]==="$"&&i.length>1&&i.shift(),this._hasParentSelector=null;var d=this._trace(i,e,["$"],s,a,r).filter(function(f){return f&&!f.isParentSelector});return d.length?!c&&d.length===1&&!d[0].hasArrExpr?this._getPreferredOutput(d[0]):d.reduce(function(f,h){var g=o._getPreferredOutput(h);return u&&Array.isArray(g)?f=f.concat(g):f.push(g),f},[]):c?[]:void 0}},p.prototype._getPreferredOutput=function(t){var e=this.currResultType;switch(e){case"all":{var r=Array.isArray(t.path)?t.path:p.toPathArray(t.path);return t.pointer=p.toPointer(r),t.path=typeof t.path=="string"?t.path:p.toPathString(t.path),t}case"value":case"parent":case"parentProperty":return t[e];case"path":return p.toPathString(t[e]);case"pointer":return p.toPointer(t.path);default:throw new TypeError("Unknown result type")}},p.prototype._handleCallback=function(t,e,r){if(e){var n=this._getPreferredOutput(t);t.path=typeof t.path=="string"?t.path:p.toPathString(t.path),e(n,r,t)}},p.prototype._trace=function(t,e,r,n,o,s,a,u){var c=this,l;if(!t.length)return l={path:r,value:e,parent:n,parentProperty:o,hasArrExpr:a},this._handleCallback(l,s,"value"),l;var i=t[0],d=t.slice(1),f=[];function h(y){Array.isArray(y)?y.forEach(function(he){f.push(he)}):f.push(y)}if((typeof i!="string"||u)&&e&&m.call(e,i))h(this._trace(d,e[i],D(r,i),e,i,s,a));else if(i==="*")this._walk(e,function(y){h(c._trace(d,e[y],D(r,y),e,y,s,!0,!0))});else if(i==="..")h(this._trace(d,e,r,n,o,s,a)),this._walk(e,function(y){v(e[y])==="object"&&h(c._trace(t.slice(),e[y],D(r,y),e,y,s,!0))});else{if(i==="^")return this._hasParentSelector=!0,{path:r.slice(0,-1),expr:d,isParentSelector:!0};if(i==="~")return l={path:D(r,i),value:o,parent:n,parentProperty:null},this._handleCallback(l,s,"property"),l;if(i==="$")h(this._trace(d,e,r,null,null,s,a));else if(/^(\x2D?[0-9]*):(\x2D?[0-9]*):?([0-9]*)$/.test(i))h(this._slice(i,d,e,r,n,o,s));else if(i.indexOf("?(")===0){if(this.currPreventEval)throw new Error("Eval [?(expr)] prevented in JSONPath expression.");var g=i.replace(/^\?\(((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?)\)$/,"$1"),S=/@(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])?((?:[\0->@-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)['\[](\??\((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\))(?!(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])\)\])['\]]/g.exec(g);S?this._walk(e,function(y){var he=[S[2]],tr=S[1]?e[y][S[1]]:e[y],rr=c._trace(he,tr,r,n,o,s,!0);rr.length>0&&h(c._trace(d,e[y],D(r,y),e,y,s,!0))}):this._walk(e,function(y){c._eval(g,e[y],y,r,n,o)&&h(c._trace(d,e[y],D(r,y),e,y,s,!0))})}else if(i[0]==="("){if(this.currPreventEval)throw new Error("Eval [(expr)] prevented in JSONPath expression.");h(this._trace(oe(this._eval(i,e,r[r.length-1],r.slice(0,-1),n,o),d),e,r,n,o,s,a))}else if(i[0]==="@"){var R=!1,I=i.slice(1,-2);switch(I){case"scalar":(!e||!["object","function"].includes(v(e)))&&(R=!0);break;case"boolean":case"string":case"undefined":case"function":v(e)===I&&(R=!0);break;case"integer":Number.isFinite(e)&&!(e%1)&&(R=!0);break;case"number":Number.isFinite(e)&&(R=!0);break;case"nonFinite":typeof e=="number"&&!Number.isFinite(e)&&(R=!0);break;case"object":e&&v(e)===I&&(R=!0);break;case"array":Array.isArray(e)&&(R=!0);break;case"other":R=this.currOtherTypeCallback(e,r,n,o);break;case"null":e===null&&(R=!0);break;default:throw new TypeError("Unknown value type "+I)}if(R)return l={path:r,value:e,parent:n,parentProperty:o},this._handleCallback(l,s,"value"),l}else if(i[0]==="`"&&e&&m.call(e,i.slice(1))){var T=i.slice(1);h(this._trace(d,e[T],D(r,T),e,T,s,a,!0))}else if(i.includes(",")){var Qt=i.split(","),G=Ft(Qt),Be;try{for(G.s();!(Be=G.n()).done;){var Xt=Be.value;h(this._trace(oe(Xt,d),e,r,n,o,s,!0))}}catch(y){G.e(y)}finally{G.f()}}else!u&&e&&m.call(e,i)&&h(this._trace(d,e[i],D(r,i),e,i,s,a,!0))}if(this._hasParentSelector)for(var A=0;A<f.length;A++){var K=f[A];if(K&&K.isParentSelector){var U=this._trace(K.expr,e,K.path,n,o,s,a);if(Array.isArray(U)){f[A]=U[0];for(var er=U.length,pe=1;pe<er;pe++)A++,f.splice(A,0,U[pe])}else f[A]=U}}return f},p.prototype._walk=function(t,e){if(Array.isArray(t))for(var r=t.length,n=0;n<r;n++)e(n);else t&&v(t)==="object"&&Object.keys(t).forEach(function(o){e(o)})},p.prototype._slice=function(t,e,r,n,o,s,a){if(Array.isArray(r)){var u=r.length,c=t.split(":"),l=c[2]&&Number.parseInt(c[2])||1,i=c[0]&&Number.parseInt(c[0])||0,d=c[1]&&Number.parseInt(c[1])||u;i=i<0?Math.max(0,i+u):Math.min(u,i),d=d<0?Math.max(0,d+u):Math.min(u,d);for(var f=[],h=i;h<d;h+=l){var g=this._trace(oe(h,e),r,n,o,s,a,!0);g.forEach(function(S){f.push(S)})}return f}},p.prototype._eval=function(t,e,r,n,o,s){this.currSandbox._$_parentProperty=s,this.currSandbox._$_parent=o,this.currSandbox._$_property=r,this.currSandbox._$_root=this.json,this.currSandbox._$_v=e;var a=t.includes("@path");a&&(this.currSandbox._$_path=p.toPathString(n.concat([r])));var u="script:"+t;if(!p.cache[u]){var c=t.replace(/@parentProperty/g,"_$_parentProperty").replace(/@parent/g,"_$_parent").replace(/@property/g,"_$_property").replace(/@root/g,"_$_root").replace(/@([\t-\r \)\.\[\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF])/g,"_$_v$1");a&&(c=c.replace(/@path/g,"_$_path")),p.cache[u]=new this.vm.Script(c)}try{return p.cache[u].runInNewContext(this.currSandbox)}catch(l){throw new Error("jsonPath: "+l.message+": "+t)}},p.cache={},p.toPathString=function(t){for(var e=t,r=e.length,n="$",o=1;o<r;o++)/^(~|\^|@(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\(\))$/.test(e[o])||(n+=/^[\*0-9]+$/.test(e[o])?"["+e[o]+"]":"['"+e[o]+"']");return n},p.toPointer=function(t){for(var e=t,r=e.length,n="",o=1;o<r;o++)/^(~|\^|@(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\(\))$/.test(e[o])||(n+="/"+e[o].toString().replace(/~/g,"~0").replace(/\//g,"~1"));return n},p.toPathArray=function(t){var e=p.cache;if(e[t])return e[t].concat();var r=[],n=t.replace(/@(?:null|boolean|number|string|integer|undefined|nonFinite|scalar|array|object|function|other)\(\)/g,";$&;").replace(/['\[](\??\((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\))['\]](?!(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])\])/g,function(s,a){return"[#"+(r.push(a)-1)+"]"}).replace(/\[["']((?:[\0-&\(-\\\^-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)["']\]/g,function(s,a){return"['"+a.replace(/\./g,"%@%").replace(/~/g,"%%@@%%")+"']"}).replace(/~/g,";~;").replace(/["']?\.["']?(?!(?:[\0-Z\\-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*\])|\[["']?/g,";").replace(/%@%/g,".").replace(/%%@@%%/g,"~").replace(/(?:;)?(\^+)(?:;)?/g,function(s,a){return";"+a.split("").join(";")+";"}).replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,""),o=n.split(";").map(function(s){var a=s.match(/#([0-9]+)/);return!a||!a[1]?s:r[a[1]]});return e[t]=o,e[t].concat()};var vt=function(e,r,n){for(var o=e.length,s=0;s<o;s++){var a=e[s];n(a)&&r.push(e.splice(s--,1)[0])}},St=function(){function t(e){Fe(this,t),this.code=e}return ve(t,[{key:"runInNewContext",value:function(r){var n=this.code,o=Object.keys(r),s=[];vt(o,s,function(i){return typeof r[i]=="function"});var a=o.map(function(i){return r[i]}),u=s.reduce(function(i,d){var f=r[d].toString();return/function/.test(f)||(f="function "+f),"var "+d+"="+f+";"+i},"");n=u+n,!/(["'])use strict\1/.test(n)&&!o.includes("arguments")&&(n="var arguments = undefined;"+n),n=n.replace(/;[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*$/,"");var c=n.lastIndexOf(";"),l=c>-1?n.slice(0,c+1)+" return "+n.slice(c+1):" return "+n;return be(Function,o.concat([l])).apply(void 0,wt(a))}}]),t}();p.prototype.vm={Script:St};const Dt={ADD_ITEMS:"cart.add-items/v1"};function xt(t){return Object.values(Dt).includes(t)}const Et={"[cart.count/v1].items":t=>{const e=window.top||window;e.P.when("nav.setCartCount").execute(function(r){r(t)}),e!==window&&window.P.when("nav.setCartCount").execute(function(r){r(t)})}};function se(t){Object.entries(Et).map(([e,r])=>{const n=p({path:"$.."+e,json:t});n.length==0?M("Could not find "+e+" in response",new Error("Invalid response. Search Result returned empty")):r(n[0])})}class ae extends H{constructor(e){super(b.RemoteAAPIBatchOperationResponse),this.payload=e}}class Pt extends Error{constructor(e){super(b.UnknownResponse),this.payload=e,this.type=b.UnknownResponse}}class ie extends H{constructor(e){super(b.LayoutDiffingResponse),this.payload=e}}class De extends H{constructor(e){super(b.CardRerenderResponse),this.payload=e}}function Ot(t){const e=t.match(/boundary=([^;]+)/);if(!e)throw new Error("No boundary found in Content-Type header");let r=e[1].trim();return r.startsWith('"')&&r.endsWith('"')&&(r=r.slice(1,-1)),r}function xe(t){const e={},r=t.trim().split(`
`);for(const n of r){const o=n.indexOf(":");if(o>0){const s=n.substring(0,o).trim(),a=n.substring(o+1).trim();e[s]=a}}return e}function At(t){const e=t.trim();if(!e)return null;const r=[`
\r
`,`\r
\r
`,`

`];for(const n of r){const o=e.indexOf(n);if(o!==-1){const s=e.substring(0,o),a=e.substring(o+n.length);return{headers:xe(s),body:a}}}return{headers:xe(e),body:""}}async function Ee(t,e){var c;const r=t.headers.get("content-type");if(!r)throw new Error("Missing Content-Type header");const o=`--${Ot(r)}`,s=(c=t.body)==null?void 0:c.getReader();if(!s)throw new Error("Response body is not readable");const a=new TextDecoder;let u="";try{for(;;){const{done:l,value:i}=await s.read();if(i){const f=a.decode(i,{stream:!0});u+=f}let d=u.indexOf(o);for(;d!==-1;){const f=d+o.length,h=u.indexOf(o,f);if(h===-1)break;let g=d+o.length;u[g]===`
`&&g++,u[g]==="\r"&&g++;const S=u.substring(g,h);u=u.substring(h),d=0;const I=u.substring(o.length,o.length+2)==="--";if(S.trim()){const T=At(S);T&&await e(T)}if(I)return}if(l)break}}finally{s.releaseLock()}}const Pe=Y.setExternalPatchReplaceTransitionState??(()=>{W("setExternalPatchReplaceTransitionState not yet implemented")}),Ct=Y.clearExternalPatchReplaceTransitionState??(()=>{W("clearExternalPatchReplaceTransitionState not yet implemented")});class O{constructor(){}static getInstance(){return O.instance||(O.instance=new O),O.instance}setCurrentRequest(e,r){this.currentFlowRoute=e,this.presentationConfig=r}getFlowRoute(){return this.currentFlowRoute}getPresentationConfig(){return this.presentationConfig}applyGrayout(){this.presentationConfig&&Pe({allowedIds:this.presentationConfig.animationIdPrefixAllowList,disallowedIds:this.presentationConfig.animationIdPrefixDisallowList})}applyGrayoutToTarget(e){this.presentationConfig&&Pe({allowedIds:this.presentationConfig.animationIdPrefixAllowList,disallowedIds:this.presentationConfig.animationIdPrefixDisallowList,targetElement:e})}clearGrayout(){Ct()}clear(){this.currentFlowRoute=void 0,this.presentationConfig=void 0}}const It=Y.patchReplaceOnExternalConfig??(()=>{W("patchReplaceOnExternalConfig not yet implemented")});class Tt{updateBrowserUrl(e){if(!(e!=null&&e.flow.inputs))return;const r=new URL(window.location.href);let n=!1,o=!1;if(e.flow.inputs.asin&&e.flow.inputs.asin!=="placeholder"){const l=String(e.flow.inputs.asin);if(r.pathname.includes("/product/")){if(/\/product\/[A-Z0-9]{10}/.test(r.pathname)){const d=r.pathname;r.pathname=r.pathname.replace(/\/product\/[A-Z0-9]{10}/,`/product/${l}`),d!==r.pathname&&(n=!0,o=!0)}}else if(r.pathname.includes("/dp/")&&/\/dp\/[A-Z0-9]{10}\//.test(r.pathname)){const d=r.pathname;r.pathname=r.pathname.replace(/\/dp\/[A-Z0-9]{10}\//,`/dp/${l}/`),d!==r.pathname&&(n=!0,o=!0)}}const s=new URLSearchParams,a=new URLSearchParams(r.search);a.forEach((l,i)=>{Z.some(d=>d.toLowerCase()===i.toLowerCase())&&s.set(i,l)}),Object.entries(e.flow.inputs).forEach(([l,i])=>{if(i!=="placeholder"){const f=typeof i=="object"&&i!==null?JSON.stringify(i):String(i);if(l==="asin"){if(o){a.has("asin")&&s.set(l,f);return}s.set(l,f);return}s.set(l,f)}});const u=s.toString(),c=r.searchParams.toString();u!==c&&(r.search=u,n=!0),n&&window.history.replaceState(null,"",r.href)}async handleRxResponse(e){if(e.ok)return this.convertToRxResponse(e);{const r=new Error("Response is not ok");throw M("Fetch call returned "+e.status+": "+r.message,r),new Pt(this.handleUnknownResponse(e))}}async convertToRxResponse(e){var r;try{if((r=e.headers.get("content-type"))!=null&&r.includes("multipart/mixed")){const n=e.headers.get("content-type"),o=n==null?void 0:n.match(/type=([^;]+)/),s=o?o[1]:null;return s==="card-rerender"?this.handleCardRerenderResponse(e):s==="layout-diffing"?this.handleLayoutDiffingResponse(e):this.handleLayoutDiffingResponse(e)}else{const n=await e.text(),o=JSON.parse(n);switch(o.type){case b.ViewPublisherResponse:return this.handleViewPublisherResponse(o);case b.RemoteViewModelMapperExecutionResponse:return this.handleRemoteViewModelMapperResponse(o);case b.RemoteAAPIBatchOperationResponse:return this.handleRemoteBatchAAPIOperationsRxResponse(this.parseBatchAAPIOperationRxResponse(o));case b.UnknownResponse:default:return this.handleUnknownResponse(e)}}}catch(n){return M("Something went wrong in WebFlowServerRxResponseHandler: "+n.message,n),this.handleUnknownResponse(e)}}parseBatchAAPIOperationRxResponse(e){return new ae(e.payload)}handleViewPublisherResponse(e){return e.payload.statusCode==200&&se(e.payload.untypedResponseBody),e}handleRemoteViewModelMapperResponse(e){return e.payload.statusCode==200&&se(e.payload.untypedResponseBody),e}handleRemoteBatchAAPIOperationsRxResponse(e){for(const r of e.payload.aapiOperationResponses)if(r.payload.statusCode===200){const{type:n,untypedResponseBody:o}=r.payload;xt(n)&&se(o)}return e}async handleCardRerenderResponse(e){const r=e.status;return r!==200?new De({status:"error",message:`Card rerender returned non-200 status code: ${r}`,statusCode:r,response:e}):(w("WebFlowJS: Card rerender returned 200 status code"),new De({status:"success",message:"Card rerender returned 200 status code",statusCode:200,response:e}))}async handleLayoutDiffingResponse(e){const r=e.status;if(r!==200)return new ie({status:"error",message:`Server returned non-200 status code: ${r}`,statusCode:r});const n=O.getInstance();try{await Ee(e,s=>{if(s.headers.Type==="diffing.node.diff/v1"){const a=document.createElement("div");return a.innerHTML=s.body,n.applyGrayoutToTarget(a),It(s.headers.referenceId,a.innerHTML)}s.headers.Type==="diffing.node.delete/v1"&&J.getInstance().deleteNodeState(s.headers.referenceId),s.headers.Type==="rxCount/v1"&&z.getInstance().setExpectedCount(parseInt(s.body))});const o=n.getFlowRoute();return o&&this.updateBrowserUrl(o),new ie({status:"success",message:"Layout diffing completed successfully",statusCode:r})}catch(o){const s=o instanceof Error?o.message:String(o);return M("WebFlowJS: Failed to process layout diffing:"+o.message,o),new ie({status:"error",message:`Failed to process layout diffing: ${s}`,statusCode:r})}}async processReentrantRenderResponse(e,r,n){var o,s,a;if(e&&typeof e=="object"&&"type"in e&&e.type===b.CardRerenderResponse){const u=e;if((o=u.payload)!=null&&o.response){const c=u.payload.response;if((a=(s=c.headers)==null?void 0:s.get("content-type"))!=null&&a.includes("multipart/mixed")){if(w("WebFlowJS: Processing multipart reentrant response"),!r.patchReplace||typeof r.patchReplace!="function")throw new Error(`patchReplace method not available for externalComposedKey: ${n}`);return await Ee(c,async l=>{l.headers.Type==="rendered-card/v1"&&(await r.patchReplace(l.body),w("WebFlowJS: Successfully patched HTML for reentrant rendering:",n))}),!0}}}return!1}handleUnknownResponse(e){return new ut(e)}}class _t{buildRemoteViewModelMapperRequestV1(e,r){return{method:"POST",requestType:"RemoteViewModelMapperExecution",schemaVersion:"V1",bundleUri:e.bundleUri,payload:{viewModelMapperLocator:e,variableTable:r.serialize()}}}buildRemoteBatchAAPIOperation(e){return{method:"POST",requestType:"RemoteBatchAAPIOperation",schemaVersion:"2",payload:e}}buildBlueprintDiffRequest(e,r){return{method:"POST",requestType:"LayoutDiffingRequest",schemaVersion:"1",payload:{previousRenderStates:e},flowRoute:r}}handleRequest(e,r){return w("payload: ",r),this.buildRxRequestBody(e,r)}buildRxRequestBody(e,r){return{resourcePath:L.resourcePath,responseType:L.responseType,method:L.method,bundleUri:e,payload:r}}buildReentrantRenderRequest(e,r,n){const{externalComposedKey:o,viewModelMapperUuid:s,metadata:{bundleUri:a="",initialViewModel:u={},inputModel:c={},aapiResourceReferences:l="",templateAssets:i={}}={}}=e,d=(()=>{try{return JSON.parse(l)}catch{return W("Failed to parse aapiResourceReferences json:",l),{}}})(),f=o.split("/"),h=f.length>5?f[5]:"";return{method:"POST",requestType:"CardRerender",schemaVersion:"1",bundleUri:a,flowRoute:{flow:{experienceId:h,inputs:{}}},payload:{rerenderInstructions:[{referenceId:o,bundleUri:a,viewModelMapperUuid:s,initialViewModel:u,inputModel:c,kataData:n,aapiResourceReferences:d,reentrantVars:r,templateAssets:i}]}}}}const Mt={bodyEnd:"be",bodyBegin:"bb"},kt="ld",Oe={wb:1},jt=t=>{w(`Start timer for latency metric: ${t}`),window.uet&&window.uet(Mt.bodyBegin,t,Oe)},Ae=t=>{w(`End timer: ${t}`),window.uex&&window.uex(kt,t,Oe)},Ce=class N{constructor(){this.webflowClient=new rt,this.rxRequestHandler=new _t,this.webflowServerRxResponseHandler=new Tt}static getInstance(){return N.instance||(N.instance=new N),N.instance}async executeRxRequest(e){const r=performance.now();try{const n=await this.webflowClient.callbackToWebFlowServer(e);return await this.webflowServerRxResponseHandler.handleRxResponse(n)}catch(n){return E("Failed to execute RxRequest - "+e,n),n.payload}finally{const o=performance.now()-r;w(`WebFlow RxRequestTime: ${o.toFixed(2)}ms`)}}async renderExperience(e,r){const n=this.rxRequestHandler.handleRequest(e,r);return this.executeRxRequest(n)}async executeRemoteViewModelMapper(e,r){const n=this.rxRequestHandler.buildRemoteViewModelMapperRequestV1(e,r);return this.executeRxRequest(n)}async executeRemoteBatchAAPIOperation(e){const r=this.rxRequestHandler.buildRemoteBatchAAPIOperation(e);return this.executeRxRequest(r)}async executeBlueprintDiffing(e,r){const n=e.flow.experienceId,o=n?`webflow-layout-diffing-${n}`:"webflow-layout-diffing",s=O.getInstance();s.setCurrentRequest(e,r),jt(o);try{s.applyGrayout(),z.getInstance().resetRenderComplete();const a=J.getInstance().getNodeStates(),u=this.rxRequestHandler.buildBlueprintDiffRequest(a,e);w("WebFlowJS: Executing blueprint diffing request:",u);const c=await this.executeRxRequest(u);return Ae(o),c}catch(a){throw Ae(o),a}finally{s.clearGrayout(),s.clear()}}getExperienceState(){return{callbackId:L.callbackId}}async executeReentrantRender(e,r,n){try{const{externalComposedKey:o,viewModelMapperUuid:s,metadata:{bundleUri:a="",initialViewModel:u={},inputModel:c={},aapiResourceReferences:l={},templateAssets:i={},...d}={}}=e;if(w("WebFlowJS: Extracted event data:",{externalComposedKey:o,viewModelMapperUuid:s,bundleUri:a,initialViewModel:u,inputModel:c,aapiResourceReferences:l,templateAssets:i,otherMetadata:d}),!r)throw new Error(`No external control provided for externalComposedKey: ${o}`);if(!r.captureVars||typeof r.captureVars!="function")throw new Error(`captureVars method not available for externalComposedKey: ${o}`);const f=await r.captureVars();w("WebFlowJS: Captured reentrant vars for",o,":",f);const h=this.rxRequestHandler.buildReentrantRenderRequest(e,f,n);w("WebFlowJS: Executing enhanced reentrant rendering request:",h);const g=await this.executeRxRequest(h);if(await this.webflowServerRxResponseHandler.processReentrantRenderResponse(g,r,o))return;throw new Error(`WebFlowJS: Reentrant Render response (non-multipart) for externalComposedKey: ${o}`)}catch(o){throw E("WebFlowJS: Reentrant rendering failed for "+((e==null?void 0:e.externalComposedKey)||"unknown"),o),o}}register(){st(this.renderExperience.bind(this),this.executeReentrantRender.bind(this))}};Ce.instance=null;let V=Ce;var C=(t=>(t.WebFlowServerError="Internal WebFlow Server Error",t.ExperienceModelError="Unexpected Input received from the experience model",t))(C||{});class ue{static async post(e,...r){const n=[e,...r].map(s=>({...s,resourcePath:this.resolveResourcePath(s.resourcePath,s.params,s.requestArguments),method:"POST"})),o=await V.getInstance().executeRemoteBatchAAPIOperation({payload:n});return o instanceof ae?this.unpackPostResponse(o,n[0]):this.ofFailedOperation(n[0],"Received unexpected response type from the server.",C.WebFlowServerError)}static unpackPostResponse(e,r){if(e.payload.statusCode==500)return this.ofFailedOperation(r,"The BatchAAPIOperationRequest failed.",C.WebFlowServerError);const n=e.payload.aapiOperationResponses[0];return n?n.payload.statusCode==500?this.ofFailedOperation(r,n.payload.untypedError,n.payload.type):this.proxyResultWithOverloadedGetOperator({isSuccess:!0,resource:n.payload.untypedResponseBody,type:n.payload.type}):this.ofFailedOperation(r,`No AAPI response was returned for this operation: ${JSON.stringify(r)}`,C.WebFlowServerError)}static get(e,r){if(e.payload)return this.ofFailedOperation(e,"GET AAPIOperation does not accept a payload.",C.ExperienceModelError);const n=this.resolveResourcePath(e.resourcePath,e.params,e.requestArguments);if(r){const a=this.stateManager.getStateByVmmId(j.AmazonApi,r,n);if(a&&!this.isResourceError(a==null?void 0:a.entity)){const u=a==null?void 0:a.entity[e.responseType];if(u)return this.proxyResultWithOverloadedGetOperator({isSuccess:!0,resource:u,type:e.responseType})}}const o=this.stateManager.getState(j.AmazonApi,n);if(this.isResourceError(o==null?void 0:o.entity))return this.remoteGetRequest(e);const s=o==null?void 0:o.entity[e.responseType];return s?this.proxyResultWithOverloadedGetOperator({isSuccess:!0,resource:s,type:e.responseType}):this.remoteGetRequest(e)}static async remoteGetRequest(e){const r=await V.getInstance().executeRemoteBatchAAPIOperation({payload:[e]});return r instanceof ae?this.unpackPostResponse(r,e):this.ofFailedOperation(e,"Received unexpected response type from the server.",C.WebFlowServerError)}static ofFailedOperation(e,r,n){const o=new Error(`AAPI resource operation failed. Operation=${JSON.stringify(e)}. Detailed Message=${r}`);return this.proxyResultWithOverloadedGetOperator({isSuccess:!1,error:o,type:n})}static isResourceError(e){return e&&"errorPayload"in e}static resolveResourcePath(e,r,n){if(r&&Object.keys(r).forEach(o=>{e=e.replace(`${o}`,r[o])}),e.includes("?")&&!n){const[o,s]=e.split("?");if(s){const u=s.split("&").sort().join("&");e=`${o}?${u}`}}return n&&(e+="?",Object.keys(n).sort().forEach(s=>{e+=`${s}=${n[s]}&`}),e=e.substring(0,e.length-1)),e}static proxyResultWithOverloadedGetOperator(e){const r={get(n,o){return n.resource&&n.resource[o]!==void 0?n.resource[o]:Reflect.get(n,o)}};return new Proxy(e,r)}}ue.stateManager=J.getInstance();function Bt(){let t=window.location.href;return t||(E("ingressUrl not presented"),t=""),{ingressUrl:t}}const $t=Bt(),Vt=()=>$t;function Ut(){const t=Vt().ingressUrl;if(!t)return"";try{return new URL(t).search??""}catch{return""}}const Ie=({request:t,queryString:e})=>{w(`addToCart: request = ${t} - queryString = ${e}`);const n={resourcePath:`/api/marketplaces/:marketplace-id/cart/carts/retail/items${e?`?${e}`:Ut()}`,requestType:"cart.add-items.request/v1",responseType:"cart.add-items/v1",payload:t,method:"POST"};return F.from(ue.post(n))},qt=new Set(["null","boolean","int","long","float","double","bytes","string","record","enum","array","map","fixed"]),Te="csa.ContentInteraction.2",_e="dawnSearch.DawnContentInteractions.4",Nt=t=>{const e={...ke(t.data),lob:"1"};return Me(t.producerId,{schemaId:t.schemaId,...e,customerId:Wt()},{ent:{page:["pageType","subPageType","requestId"],element:!0}}),t.schemaId===_e&&(w(`[logClientSideAnalyticsEvent] Dual-publishing ${_e} event to ${Te}`),Me(t.producerId,{schemaId:Te,...e},{ent:{page:["pageType","subPageType"],element:!0}})),F.EMPTY};function Wt(){var t,e,r,n,o;return((t=window.opts)==null?void 0:t.customerId)??((o=(n=(r=(e=window.$Nav)==null?void 0:e.getNow)==null?void 0:r.call(e,"config"))==null?void 0:n.searchISS)==null?void 0:o.customerId)??""}function Me(t,e,r){var o;const n=(o=window==null?void 0:window.csa)==null?void 0:o.call(window,"Events",{producerId:t});if(!n){w("[logClientSideAnalyticsEvent] CSA API not available, unable to log event.");return}w(`[logClientSideAnalyticsEvent] Logging event to CSA:
event = ${JSON.stringify(e,null,4)}
option = ${JSON.stringify(r,null,4)}`),n("log",e,r)}function ke(t){const e={};for(const[r,n]of Object.entries(t))e[r]=ce(n);return e}function ce(t){if(t==null)return t;if(Array.isArray(t))return t.map(ce);if(typeof t=="object"){const e=Object.keys(t);return e.length===1&&qt.has(e[0])?ce(t[e[0]]):ke(t)}return t}const Lt=({objectToStringify:t})=>{try{return JSON.stringify(t)}catch(e){throw new Error(`Serialization failed: ${e}`)}},Jt=({stringToLog:t})=>{w("[FlowLog]: "+t)},le=new Map,je=new Set;function zt(t,e){le.has(e)||le.set(e,new Map);const r=le.get(e);if(!r.has(t)){const n=new F.Subject,o=n.next.bind(n);n.next=l=>{o(l);try{P.when("A").execute(i=>{i&&i.trigger&&i.trigger("flowReactiveViewSubject:"+t,l)})}catch(i){E("Failed to execute P.now(A).execute() for subject: "+t,i)}};const s=n.asObservable();s.asReactiveViewValue=()=>F.ofReactiveViewValue(n.asObservable());const a=`flowReactiveViewSubject:${t}`;if(!je.has(a))try{P.when("A").execute(l=>{l&&l.on&&(l.on(a,i=>{o(i)}),je.add(a),l.trigger&&l.trigger(`flow-icc-ready:${t}`,t))})}catch(l){E("Failed to set up AUI event listener for subject: "+t,l)}const u=F.ofReactiveViewPublisher(n),c={value:s,publisher:u};r.set(t,c)}return r.get(t)}const Ht=({id:t,webFlowRequestId:e})=>zt(t,e),Gt=({route:t,presentationConfig:e})=>{V.getInstance().executeBlueprintDiffing(t,e)};class Kt{constructor(){this.invokeFunction=(e,r)=>e in this.functions?this.functions[e](r):(console.warn(`No implementation defined for ${e}! Skipping execution.`),F.EMPTY),this.functions={showUpdatableToast:Ye,showPriceInfo:et,addToCart:Ie,addToCartTemp:Ie,logClientSideAnalyticsEvent:Nt,stringify:Lt,log:Jt,bindReactiveViewSubject:Ht,flowExperienceRenderComplete:nt,show:Gt}}registerFunction(e,r){this.functions[e]=r}}const de=new Kt;function Yt(t,e){return F.from(V.getInstance().executeRemoteViewModelMapper(t,e))}const fe=V.getInstance();fe.register();const Zt=fe.executeBlueprintDiffing.bind(fe);x.AAPIResourceManager=ue,x.executeBlueprintDiffing=Zt,x.executePortableFunction=Je,x.executeRemoteViewModelMapper=Yt,x.functionRegistry=de,x.registerPortableFunction=Le,Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})});
